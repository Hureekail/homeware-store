image: docker:latest

services:
  - docker:24-dind    

variables:
  DOCKER_DRIVER: overlay2

stages:         
  - build
  - test
  - deploy

build-job:      
  stage: build
  script:
    - docker build -t my-backend backend/.
    - docker build -t my-frontend frontend/.
   

unit-test-job: 
  stage: test  
  script:
    - docker run --rm my-backend python manage.py test -s -v

deploy-job: 
  stage: deploy
  script:
    - docker compose up -d